5-1 intro
文件的优点：
1 用户使用方便
2 文件安全可靠：文件系统提供安全保密措施
3 文件可备份：文件系统可组织重执
4 文件可共享：文件系统提供文件共享功能
 
5-2 文件系统
操作系统中负责存取和管理信息的模块
反映了用户概念中的逻辑结构和存储结构
 
文件系统面向用户的功能：
1 文件按名存取
2 文件共享与保护
3 文件的操作和使用
 
文件系统的组成
 
 
5-3 文件的存储
卷：存储介质的物理单位
块：存储介质上连续信息所组成的一个区域
 
顺序存取存储设备：严格按信息的物理位置进行定位和读写
e.g.磁带、光盘
 
直接存取存储设备：每个物理记录有确定的位置和唯一的地址
e.g. 磁盘
 
5-4 文件的逻辑结构
独立于物理环境的，用户能观察到的数据集合
 
流式文件：由一串依次的字节组成的信息流序列
记录式文件：有结构的文件，若干逻辑记录信息
 
 
 
记录式文件与数据库的关系：
1 数据库管理系统也支持逻辑记录
2 数据库中的记录之间可以通过数据冗余构成联系
3 数据库管理系统支持基于联系的数据查询，文件系统则不行
 
5-5 文件的物理结构
物理存储空间中的存放方法和组织关系
 
顺序文件：将一个文件中逻辑上连续的信息存放到存储介质的依次相邻的块中
e.g. 磁带文件、光盘文件
优点：顺序存取记录时速度快（系统文件、批处理文件）
缺点：建立文件前要预先确定文件长度，修改插入增加文件记录困难
 
连接文件：用连接字表示文件中各个物理块之间的先后次序
优点：易于修改插入增加
缺点：存放指针需要额外空间，只适用于顺序存取（类似链表）
 
直接文件：记录关键字和物理地址的对应关系（hash）
 
索引文件：用索引表记录逻辑记录号和存储地址
索引区和数据区
 
第一步查找索引表
第二步获得记录物理地址
需要两次访问辅存。若文件索引预先调入主存，可减少一次内外存信息交换
 
集中存放不同的连接文件，构成索引表
索引表按顺序文件的方式加以改造
 
小文件层数少
 
5-7 文件的目录结构
文件目录是实现文件的按名存取的关键数据结构
文件系统的基本功能之一是负责文件目录的建立、维护和冲突检索
保存文件目录的文件称为目录文件
 
一级目录结构：在操作系统中构造一张线性表，与每个文件相关的属性占用一个目录项
 
二级目录结构：
第一级为主文件目录，登记用户的名字及其文件目录的地址
第二级为用户文件目录，为用户的每个文件保存一个登记栏
 
树形目录结构：每一级目录可以登记下一级目录，也可以登记文件
一个文件的全名包括从根目录开始到文件为止，通路上遇到的所有子目录路径，即路径名
一个硬盘分区可以组成一颗子树
 
 
5-8 文件目录的管理
文件查找：“按名存取”文件是系统根据用户提供的文件路径名，搜索各级文件目录，找到该文件
目录项查找：顺序查找、二分查找
 
活动文件表：
为每个用户进程建立一张活动文件表，
用户使用一个文件前，通过“打开”操作，把有关信息填入活动文件表，建立用户进程和该文件索引的联系
不再使用该文件时，使用“关闭”，切断用户进程和文件的联系
 
5-9 文件的安全
文件共享：不同用户共同使用某些文件
文件保护：防止文件被破坏
文件保密：防止文件及其内容被其他用户窃取
 
文件共享的并发控制：
多个进程同时读一个文件，操作系统对文件进行公用控制
某个进程写的同时另一个进程度文件，操作系统提供同步控制机制
 
文件保密的措施：
隐蔽文件目录
设置口令
使用密码
 
文件保护的措施：
1 文件副本
（1）动态多副本
多个介质上维持同一内容的文件，在更新内容时同时更新
（2）文件转储
定时把文件复制到其他介质
 
2 文件的存取控制矩阵
系统为每个用户设置访问每个文件对象的存取属性
系统的全部用户对全部文件的存取属性就组成了一个二维矩阵，即存取控制矩阵
存取控制矩阵是一个稀疏矩阵，因此可以简化为一张存取控制表（用户+文件+存取属性）
 
3 文件属性
用户分类，再针对每类用户规定文件属性。
用户分类：属主、合作者、其他
文件属性：读、写、执行
文件属性可以放在文件目录项中
e.g. 
 
 
5-11 文件的存取方法
1 顺序存取：按记录顺序进行读写操作（读指针、写指针）
2 直接存取：以任意次序直接读写某个记录
e.g. 航空订票系统（key：航班号）
3 索引存取：基于索引文件
 
与文件有关的unix操作命令： cat, cd, cp, find, mv, rm, mkdir, rmdir
 
5-13 辅存空间管理
随着用户文件建立和撤销，文件存储空间会出现许多“碎片”
操作系统解决“碎片”的方法是整理“碎片”
 
辅存空间的分配：
连续分配：放在连续存储区，顺序访问速度快
非连续分配：动态分配，空间管理效率高，便于文件动态增减
 
空闲块的管理：位示图
“1”表示相应块已占用，“0”表示该块空闲
 
空闲块成组连接法：
 
（数字代表地址）
第一块指向连接内容，其余块指向空闲块
 
5-14 文件系统的实现层次
 

